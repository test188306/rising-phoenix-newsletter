<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student // Blog - Lifestyle & Events</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configure Tailwind to match Custom CSS Variables & Enable Dark Mode -->
    <script>
        tailwind.config = {
            darkMode: 'class', // Enable class-based dark mode
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'evo-gold': '#FFD700', // Bright Golda
                        'evo-red': '#8B0000', // Darker Crimson Red (was #E50020)
                        'dark-text': '#111827', 
                        'pastel-grey': '#E5E7EB',
                        'evo-accent': '#8B0000' // Updated to match
                    },
                    boxShadow: {
                        'soft': '0 10px 40px -10px rgba(0,0,0,0.08)',
                        'glow': '0 0 15px rgba(255, 215, 0, 0.3)'
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom Font Setup */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap');
        
        body {
            background-color: #E5E7EB; /* Light mode default */
            color: #111827;
            overflow-x: hidden; /* Prevent horizontal clipping/scroll */
        }
        
        /* Dark Mode Global Styles */
        .dark body {
            background-color: #111827;
            color: #F3F4F6;
        }

        /* Smooth Fade In Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fadeIn 0.6s ease-out forwards;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        .dark ::-webkit-scrollbar-track {
            background: #1F2937;
        }
        ::-webkit-scrollbar-thumb {
            background: #d1d5db; 
            border-radius: 4px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #4B5563;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af; 
        }

        /* Text Selection */
        ::selection {
            background-color: #FFD700;
            color: #8B0000;
        }

        /* Standardized Slash Style */
        .brand-slash {
            color: #FFD700 !important; /* Force evo-gold */
            font-style: italic;
            font-weight: 900;
            margin-right: 0.15rem; /* Slightly reduced margin for mobile compactness */
            margin-left: 0.15rem;
            display: inline-block;
            transform: skewX(-10deg); /* Consistent angle */
        }

        /* Nav Tab */
        .nav-tab {
            position: relative;
            background: white;
            padding: 12px 24px;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
            font-weight: 800;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            top: -2px; 
            border: 1px solid #f3f4f6;
            border-top: none;
            cursor: pointer;
        }
        .dark .nav-tab {
            background: #1F2937;
            border-color: #374151;
            color: #E5E7EB;
        }

        .nav-tab:hover, .group:hover .nav-tab-trigger {
            top: 2px; 
            background-color: #8B0000;
            box-shadow: none;
            color: white; 
        }

        /* Dropdown Menu Styling */
        .category-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            min-width: 450px;
            box-shadow: 0 20px 40px -5px rgba(0,0,0,0.1);
            border-radius: 0 0 16px 16px;
            padding: 24px;
            z-index: 40;
            border: 1px solid #f3f4f6;
            border-top: 4px solid #FFD700;
            pointer-events: auto;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s, transform 0.3s;
        }
        .dark .category-menu {
            background: #1F2937;
            border-color: #374151;
            border-top-color: #FFD700;
        }

        .group:hover .category-menu {
            display: grid;
            opacity: 1;
            transform: translateY(0);
            grid-template-columns: 1fr 1fr;
            gap: 32px;
        }

        /* Card Styles */
        .evo-card {
            background-color: white;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid transparent;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .dark .evo-card {
            background-color: #1F2937;
            border-color: #374151;
        }

        .evo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.1);
            border-color: rgba(139, 0, 0, 0.1);
        }

        .evo-btn {
            background-color: #8B0000;
            color: white;
            padding: 0.75rem 2.5rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        .evo-btn:hover {
            background-color: black;
            color: #FFD700;
            box-shadow: 0 10px 20px -5px rgba(139, 0, 0, 0.4); 
        }
        .dark .evo-btn:hover {
            background-color: white;
            color: #8B0000;
        }

        /* Filter Controls */
        .filter-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23111827' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.75rem center;
            background-repeat: no-repeat;
            background-size: 1em 1em;
            padding-right: 2.5rem;
            appearance: none;
        }
        .dark .filter-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23ffffff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        }

        /* Admin Styles */
        .modal-overlay {
            background-color: rgba(17, 24, 39, 0.7);
            backdrop-filter: blur(8px);
        }
    </style>
</head>
<body class="text-dark-text antialiased selection:bg-evo-gold selection:text-evo-red dark:bg-gray-900 dark:text-gray-100 transition-colors duration-300">

    <!-- PERMANENT NAVIGATION BUTTONS (Moved to Top Right) -->
    <div class="fixed top-28 right-6 z-[90] flex flex-col space-y-4">
        <button onclick="handleGlobalBack()" class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm text-dark-text dark:text-white p-3 rounded-full shadow-lg border border-white/50 dark:border-gray-700 hover:bg-white hover:scale-110 transition-all duration-300 group" title="Back">
            <svg class="w-5 h-5 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
        </button>
        <button onclick="resetToHome()" class="bg-evo-red/90 backdrop-blur-sm text-white p-3 rounded-full shadow-lg hover:bg-black hover:scale-110 transition-all duration-300" title="Home">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
        </button>
    </div>

    <!-- DARK MODE SWITCH (Bottom Right) -->
    <button onclick="toggleDarkMode()" class="fixed bottom-6 right-6 z-[100] bg-white dark:bg-gray-800 text-dark-text dark:text-evo-gold p-4 rounded-full shadow-2xl border-2 border-gray-100 dark:border-gray-700 hover:scale-110 transition-transform duration-300" title="Toggle Dark Mode">
        <!-- Sun Icon (Hidden in Dark Mode) -->
        <svg id="theme-sun" class="w-6 h-6 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
        <!-- Moon Icon (Hidden in Light Mode) -->
        <svg id="theme-moon" class="w-6 h-6 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
    </button>

    <!-- LOGIN MODAL -->
    <div id="login-modal" class="hidden fixed inset-0 z-[100] modal-overlay flex justify-center items-center p-4">
        <div class="bg-white dark:bg-gray-800 p-10 rounded-2xl max-w-sm w-full shadow-2xl border-t-8 border-evo-red relative animate-fade-in-up">
            <button onclick="closeLogin()" class="absolute top-4 right-4 text-gray-400 hover:text-black dark:hover:text-white transition">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
            <h2 class="text-3xl font-black uppercase mb-2 text-center italic tracking-tighter dark:text-white">Developer</h2>
            <p class="text-center text-xs font-bold text-evo-gold uppercase tracking-widest mb-8">Secure Access</p>
            
            <div id="login-error" class="hidden bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 p-3 rounded-lg text-xs font-bold mb-6 text-center border border-red-100 dark:border-red-900">Invalid Credentials</div>
            
            <form id="login-form" class="space-y-5">
                <div>
                    <label class="block text-[10px] font-black uppercase text-gray-400 tracking-wider mb-2">Username</label>
                    <input type="text" id="username" class="w-full bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-evo-gold focus:bg-white dark:focus:bg-gray-600 transition font-bold text-sm dark:text-white">
                </div>
                <div>
                    <label class="block text-[10px] font-black uppercase text-gray-400 tracking-wider mb-2">Password</label>
                    <input type="password" id="password" class="w-full bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 p-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-evo-gold focus:bg-white dark:focus:bg-gray-600 transition font-bold text-sm dark:text-white">
                </div>
                <button type="submit" class="w-full evo-btn mt-2 rounded-lg shadow-lg">Login</button>
            </form>
        </div>
    </div>

    <!-- KEY DATES MODAL -->
    <div id="key-dates-modal" class="hidden fixed inset-0 z-[150] bg-white/95 dark:bg-gray-900/95 backdrop-blur-xl flex flex-col animate-fade-in-up overflow-hidden">
        <!-- Header with Close -->
        <div class="flex justify-between items-center p-8 md:p-12 border-b border-gray-100/50 dark:border-gray-700/50 sticky top-0 z-10">
             <button onclick="closeKeyDatesModal()" class="text-dark-text dark:text-white hover:text-evo-red p-3 bg-white dark:bg-gray-800 shadow-sm hover:shadow-md rounded-full transition group border border-gray-100 dark:border-gray-700" title="Back">
                <svg class="w-6 h-6 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            </button>
             <h2 class="text-3xl md:text-6xl font-black uppercase italic text-dark-text dark:text-white text-right tracking-tighter">
                 <span class="brand-slash">//</span> Key <span class="text-evo-gold">Dates</span>
             </h2>
        </div>
        
        <!-- Grid -->
       <div class="flex-1 overflow-y-auto p-8 md:p-16">
    <div class="max-w-4xl mx-auto space-y-8">

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-evo-gold text-dark-text p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">08</span>
                <span class="block text-sm font-bold uppercase tracking-widest">Jan</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">Year 13 Parents' Evening</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2026 - Physical Event.</p>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-evo-gold text-dark-text p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">29</span>
                <span class="block text-sm font-bold uppercase tracking-widest">Jan</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">Year 11 Parents' Evening</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2026 - Physical Event.</p>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-evo-gold text-dark-text p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">26</span>
                <span class="block text-sm font-bold uppercase tracking-widest">Feb</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">Year 12 Parents' Evening</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2026 - Physical Event.</p>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-evo-gold text-dark-text p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">04</span>
                <span class="block text-sm font-bold uppercase tracking-widest">Mar</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">Year 9 Curriculum Evening</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2026 - Curriculum information event.</p>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-evo-gold text-dark-text p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">19</span>
                <span class="block text-sm font-bold uppercase tracking-widest">Mar</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">Year 9 Parents' Evening</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2026 - Virtual Event.</p>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-evo-gold text-dark-text p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">21</span>
                <span class="block text-sm font-bold uppercase tracking-widest">May</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">Year 7 Parents' Evening</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2026 - Virtual Event.</p>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-evo-gold text-dark-text p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">04</span>
                <span class="block text-sm font-bold uppercase tracking-widest">Jun</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">Year 8 Parents' Evening</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2026 - Virtual Event.</p>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-evo-gold text-dark-text p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">17</span>
                <span class="block text-sm font-bold uppercase tracking-widest">Jun</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">Year 10 Parents' Evening</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2026 - Virtual Event.</p>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-gray-100 dark:bg-gray-700 text-dark-text dark:text-white p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">05</span>
                <span class="block text-sm font-bold uppercase tracking-widest">Jan</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">Start of Spring Term</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2027 - All students return.</p>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-evo-red text-white p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">15</span>
                <span class="block text-sm font-bold uppercase tracking-widest">Feb</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">February Half-Term</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2027 - Monday 15th Feb to Friday 19th Feb. Students return Monday 22nd Feb.</p>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-evo-red text-white p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">25</span>
                <span class="block text-sm font-bold uppercase tracking-widest">Mar</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">End of Spring Term</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2027 - Final day of Spring Term.</p>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-gray-100 dark:bg-gray-700 text-dark-text dark:text-white p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">12</span>
                <span class="block text-sm font-bold uppercase tracking-widest">Apr</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">Start of Summer Term</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2027 - All students return for Summer Term 1.</p>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-evo-red text-white p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">31</span>
                <span class="block text-sm font-bold uppercase tracking-widest">May</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">May Half-Term</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2027 - Monday 31st May to Friday 4th June. Students return Tuesday 8th June.</p>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-8 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col md:flex-row gap-8 items-start hover:border-evo-gold transition">
            <div class="flex-shrink-0 bg-evo-red text-white p-6 rounded-2xl text-center min-w-[120px]">
                <span class="block text-4xl font-black">20</span>
                <span class="block text-sm font-bold uppercase tracking-widest">Jul</span>
            </div>
            <div>
                <h3 class="text-2xl font-black uppercase italic text-dark-text dark:text-white mb-2">End of Summer Term</h3>
                <p class="text-gray-500 dark:text-gray-400 leading-relaxed">2027 - Break up for Summer. End of student term.</p>
            </div>
        </div>

    </div>
</div>


    <!-- CATEGORIES FULL PAGE MODAL -->
    <div id="categories-modal" class="hidden fixed inset-0 z-[150] bg-white/95 dark:bg-gray-900/95 backdrop-blur-xl flex flex-col animate-fade-in-up overflow-hidden">
        <!-- Header with Close -->
        <div class="flex justify-between items-center p-8 md:p-12 border-b border-gray-100/50 dark:border-gray-700/50 sticky top-0 z-10">
             <button onclick="closeCategoriesModal()" class="text-dark-text dark:text-white hover:text-evo-red p-3 bg-white dark:bg-gray-800 shadow-sm hover:shadow-md rounded-full transition group border border-gray-100 dark:border-gray-700" title="Back">
                <svg class="w-6 h-6 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
            </button>
             <h2 class="text-3xl md:text-6xl font-black uppercase italic text-dark-text dark:text-white text-right tracking-tighter">
                 <span class="brand-slash">//</span> Explore <span class="text-evo-gold">Topics</span>
             </h2>
        </div>
        
        <!-- Grid -->
        <div class="flex-1 overflow-y-auto p-8 md:p-16">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto">
                <button onclick="filterByCategory('Arts')" class="bg-white dark:bg-gray-800 p-10 rounded-3xl shadow-sm hover:shadow-2xl border border-gray-100 dark:border-gray-700 hover:border-evo-gold transition-all duration-300 group text-left h-56 flex flex-col justify-between hover:-translate-y-2">
                    <div class="w-12 h-12 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center text-gray-300 dark:text-gray-500 group-hover:bg-evo-gold group-hover:text-white transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path></svg>
                    </div>
                    <div>
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 block group-hover:text-evo-gold transition">Filter By</span>
                        <h3 class="text-4xl font-black uppercase italic text-gray-800 dark:text-white group-hover:text-evo-red transition duration-300">Arts</h3>
                    </div>
                </button>

                <button onclick="filterByCategory('Current Affairs')" class="bg-white dark:bg-gray-800 p-10 rounded-3xl shadow-sm hover:shadow-2xl border border-gray-100 dark:border-gray-700 hover:border-evo-gold transition-all duration-300 group text-left h-56 flex flex-col justify-between hover:-translate-y-2">
                    <div class="w-12 h-12 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center text-gray-300 dark:text-gray-500 group-hover:bg-evo-gold group-hover:text-white transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path></svg>
                    </div>
                    <div>
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 block group-hover:text-evo-gold transition">Filter By</span>
                        <h3 class="text-4xl font-black uppercase italic text-gray-800 dark:text-white group-hover:text-evo-red transition duration-300">Current Affairs</h3>
                    </div>
                </button>

                <button onclick="filterByCategory('Humanities')" class="bg-white dark:bg-gray-800 p-10 rounded-3xl shadow-sm hover:shadow-2xl border border-gray-100 dark:border-gray-700 hover:border-evo-gold transition-all duration-300 group text-left h-56 flex flex-col justify-between hover:-translate-y-2">
                    <div class="w-12 h-12 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center text-gray-300 dark:text-gray-500 group-hover:bg-evo-gold group-hover:text-white transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    </div>
                    <div>
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 block group-hover:text-evo-gold transition">Filter By</span>
                        <h3 class="text-4xl font-black uppercase italic text-gray-800 dark:text-white group-hover:text-evo-red transition duration-300">Humanities</h3>
                    </div>
                </button>

                <button onclick="filterByCategory('Opinion Pieces')" class="bg-white dark:bg-gray-800 p-10 rounded-3xl shadow-sm hover:shadow-2xl border border-gray-100 dark:border-gray-700 hover:border-evo-gold transition-all duration-300 group text-left h-56 flex flex-col justify-between hover:-translate-y-2">
                    <div class="w-12 h-12 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center text-gray-300 dark:text-gray-500 group-hover:bg-evo-gold group-hover:text-white transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>
                    </div>
                    <div>
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 block group-hover:text-evo-gold transition">Filter By</span>
                        <h3 class="text-4xl font-black uppercase italic text-gray-800 dark:text-white group-hover:text-evo-red transition duration-300">Opinion Pieces</h3>
                    </div>
                </button>

                <button onclick="filterByCategory('Science')" class="bg-white dark:bg-gray-800 p-10 rounded-3xl shadow-sm hover:shadow-2xl border border-gray-100 dark:border-gray-700 hover:border-evo-gold transition-all duration-300 group text-left h-56 flex flex-col justify-between hover:-translate-y-2">
                    <div class="w-12 h-12 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center text-gray-300 dark:text-gray-500 group-hover:bg-evo-gold group-hover:text-white transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                    </div>
                    <div>
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 block group-hover:text-evo-gold transition">Filter By</span>
                        <h3 class="text-4xl font-black uppercase italic text-gray-800 dark:text-white group-hover:text-evo-red transition duration-300">Science</h3>
                    </div>
                </button>

                <button onclick="filterByCategory('Tech')" class="bg-white dark:bg-gray-800 p-10 rounded-3xl shadow-sm hover:shadow-2xl border border-gray-100 dark:border-gray-700 hover:border-evo-gold transition-all duration-300 group text-left h-56 flex flex-col justify-between hover:-translate-y-2">
                    <div class="w-12 h-12 bg-gray-50 dark:bg-gray-700 rounded-full flex items-center justify-center text-gray-300 dark:text-gray-500 group-hover:bg-evo-gold group-hover:text-white transition">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                    </div>
                    <div>
                        <span class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 block group-hover:text-evo-gold transition">Filter By</span>
                        <h3 class="text-4xl font-black uppercase italic text-gray-800 dark:text-white group-hover:text-evo-red transition duration-300">Tech</h3>
                    </div>
                </button>
            </div>
        </div>
    </div>

    <!-- MAIN DASHBOARD OVERVIEW MODAL -->
    <div id="dashboard-modal" class="hidden fixed inset-0 z-[100] modal-overlay flex justify-center items-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl w-full max-w-4xl h-[80vh] shadow-2xl border-t-8 border-evo-red relative flex flex-col overflow-hidden animate-fade-in-up">
            <!-- Header -->
            <div class="bg-gray-50 dark:bg-gray-900 p-6 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-black uppercase italic text-dark-text dark:text-white">Editor <span class="text-evo-gold">Dashboard</span></h2>
                    <p class="text-xs text-gray-500 font-bold uppercase tracking-wider mt-1">Manage Content</p>
                    <p id="connection-status" class="text-[10px] font-bold mt-1 text-red-500">â—‹ Disconnected</p>
                </div>
                <button onclick="closeDashboard()" class="text-gray-400 hover:text-black dark:hover:text-white p-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <!-- Content Area -->
            <div class="flex-1 overflow-y-auto p-6 md:p-8 bg-white dark:bg-gray-800">
                
                <!-- Action Bar -->
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-lg font-bold uppercase tracking-widest text-gray-400">Current Articles</h3>
                    
                    <!-- THE PLUS KEY -->
                    <button onclick="openAddArticleForm()" class="group flex items-center space-x-3 bg-evo-gold hover:bg-black text-white px-6 py-3 rounded-lg shadow-lg transition-all transform hover:scale-105">
                        <div class="bg-white text-evo-gold group-hover:text-black rounded-full p-1">
                            <svg class="w-4 h-4 font-black" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="4"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"></path></svg>
                        </div>
                        <span class="font-black uppercase tracking-wider text-sm">Add Article</span>
                    </button>
                </div>

                <!-- Articles List -->
                <div id="dashboard-list" class="space-y-4">
                    <!-- Dynamic Items will be injected here -->
                </div>
                
                <div class="mt-8 pt-8 border-t border-gray-100 dark:border-gray-700">
                    <h4 class="text-xs font-bold uppercase text-gray-300 mb-4">Static Content Preview</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 opacity-60">
                         <div class="border border-gray-200 dark:border-gray-600 p-4 rounded bg-gray-50 dark:bg-gray-700 dark:text-gray-300"><span class="text-xs font-bold text-evo-red block">Science</span>Hermione's Handbag</div>
                         <div class="border border-gray-200 dark:border-gray-600 p-4 rounded bg-gray-50 dark:bg-gray-700 dark:text-gray-300"><span class="text-xs font-bold text-evo-red block">Science</span>Quantum Leap</div>
                    </div>
                 </div>
            </div>
        </div>
    </div>

    <!-- ARTICLE WRITER MODAL (Form) -->
    <div id="admin-panel" class="hidden fixed inset-0 z-[110] modal-overlay flex justify-center items-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl w-full max-w-2xl h-[90vh] overflow-y-auto shadow-2xl border-t-4 border-evo-gold relative flex flex-col">
            <div class="p-8 pb-0 flex justify-between items-center">
                <button onclick="backToDashboard()" class="text-xs font-bold uppercase text-gray-400 hover:text-evo-red flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    Back to Dashboard
                </button>
                <h2 class="text-2xl font-black uppercase italic dark:text-white">New <span class="text-evo-red">Article</span></h2>
            </div>
            
            <div class="p-8 flex-1">
                <form id="article-form" class="space-y-6">
                    <div class="grid grid-cols-1 gap-6">
                        <div>
                            <label class="block text-xs font-bold uppercase mb-1 text-gray-500">Title</label>
                            <input type="text" id="post-title" required class="w-full bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 p-3 rounded focus:outline-none focus:ring-1 focus:ring-evo-red font-bold dark:text-white" placeholder="E.g. The Future of AI">
                        </div>
                        
                        <!-- MULTI-SELECT CATEGORIES -->
                        <div>
                            <label class="block text-xs font-bold uppercase mb-2 text-gray-500">Categories (Select Multiple)</label>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 bg-gray-50 dark:bg-gray-700 p-4 rounded border border-gray-200 dark:border-gray-600">
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="post-cat" value="Arts" class="form-checkbox text-evo-red rounded focus:ring-evo-gold">
                                    <span class="text-sm font-medium text-dark-text dark:text-gray-200">Arts</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="post-cat" value="Current Affairs" class="form-checkbox text-evo-red rounded focus:ring-evo-gold">
                                    <span class="text-sm font-medium text-dark-text dark:text-gray-200">Current Affairs</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="post-cat" value="Humanities" class="form-checkbox text-evo-red rounded focus:ring-evo-gold">
                                    <span class="text-sm font-medium text-dark-text dark:text-gray-200">Humanities</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="post-cat" value="Opinion Pieces" class="form-checkbox text-evo-red rounded focus:ring-evo-gold">
                                    <span class="text-sm font-medium text-dark-text dark:text-gray-200">Opinion Pieces</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="post-cat" value="Science" class="form-checkbox text-evo-red rounded focus:ring-evo-gold">
                                    <span class="text-sm font-medium text-dark-text dark:text-gray-200">Science</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer">
                                    <input type="checkbox" name="post-cat" value="Tech" class="form-checkbox text-evo-red rounded focus:ring-evo-gold">
                                    <span class="text-sm font-medium text-dark-text dark:text-gray-200">Tech</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- New Subject Field -->
                    <div>
                        <label class="block text-xs font-bold uppercase mb-1 text-gray-500">Specific Subject (Optional)</label>
                        <input type="text" id="post-subject" class="w-full bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 p-3 rounded focus:outline-none focus:ring-1 focus:ring-evo-red font-bold dark:text-white" placeholder="E.g. Chemistry, History, Art">
                    </div>

                    <!-- New Year Group Field (Updated with Year 12/13) -->
                    <div>
                         <label class="block text-xs font-bold uppercase mb-1 text-gray-500">Target Year Group</label>
                         <select id="post-year" class="filter-select w-full bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 p-3 rounded focus:outline-none focus:ring-1 focus:ring-evo-red dark:text-white">
                             <option value="All">All Years</option>
                             <option value="Year 7">Year 7</option>
                             <option value="Year 8">Year 8</option>
                             <option value="Year 9">Year 9</option>
                             <option value="Year 10">Year 10</option>
                             <option value="Year 11">Year 11</option>
                             <option value="Year 12">Year 12</option>
                             <option value="Year 13">Year 13</option>
                             <option value="Staff">Staff</option>
                         </select>
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase mb-1 text-gray-500">Image URL</label>
                        <input type="text" id="post-image" class="w-full bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 p-3 rounded focus:outline-none focus:ring-1 focus:ring-evo-red dark:text-white" placeholder="https://...">
                        <p class="text-[10px] text-gray-400 mt-1">Leave blank for a random placeholder.</p>
                    </div>

                    <div>
                        <label class="block text-xs font-bold uppercase mb-1 text-gray-500">Summary / Content</label>
                        <textarea id="post-content" required rows="6" class="w-full bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 p-3 rounded focus:outline-none focus:ring-1 focus:ring-evo-red dark:text-white" placeholder="Write the full article content here..."></textarea>
                    </div>

                    <div>
                         <label class="block text-xs font-bold uppercase mb-1 text-gray-500">Publisher / Author</label>
                         <input type="text" id="post-author" value="Editor" class="w-full bg-gray-50 dark:bg-gray-700 border border-gray-200 dark:border-gray-600 p-3 rounded focus:outline-none focus:ring-1 focus:ring-evo-red dark:text-white">
                    </div>

                    <div class="pt-4 border-t border-gray-100 dark:border-gray-700">
                        <button type="submit" class="w-full evo-btn text-center">Publish Article</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- ARTICLE READER MODAL (Full Screen Page Style) -->
    <div id="read-modal" class="hidden fixed inset-0 z-[200] bg-white dark:bg-gray-900 overflow-y-auto animate-fade-in">
        <!-- Sticky Navigation Header -->
        <div class="fixed top-0 left-0 w-full bg-white/90 dark:bg-gray-900/90 backdrop-blur-md border-b border-gray-100 dark:border-gray-800 z-50 px-6 py-4 md:px-12 flex justify-between items-center transition-all duration-300 shadow-sm">
             <button onclick="closeReader()" class="flex items-center space-x-3 text-dark-text dark:text-white hover:text-evo-red transition group">
                <div class="bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 group-hover:bg-evo-red group-hover:border-evo-red group-hover:text-white p-2 rounded-full transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                </div>
                <span class="font-black uppercase tracking-widest text-xs">Back to Feed</span>
             </button>
             
             <div class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-300 hidden md:block">
                 Reading Mode
             </div>
        </div>

        <div class="max-w-5xl mx-auto pt-24 pb-20 px-4 md:px-8">
             <!-- Hero Image Section -->
             <div class="h-[50vh] md:h-[65vh] w-full rounded-3xl overflow-hidden shadow-2xl mb-16 relative group">
                 <img id="reader-image" src="" class="w-full h-full object-cover transition duration-1000 ease-in-out group-hover:scale-105">
                 <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>
                 <div class="absolute bottom-0 left-0 p-8 md:p-16 w-full">
                    <div class="flex flex-wrap gap-3 mb-6">
                        <span id="reader-category" class="px-4 py-1 bg-evo-red text-white text-[10px] font-black uppercase tracking-widest shadow-lg rounded-full">Category</span>
                        <span id="reader-year" class="px-4 py-1 bg-white/20 backdrop-blur-md text-white text-[10px] font-black uppercase tracking-widest border border-white/30 rounded-full">Year Group</span>
                    </div>
                    <h1 id="reader-title" class="text-3xl md:text-7xl font-black uppercase italic leading-none text-white drop-shadow-xl mb-2">Title</h1>
                 </div>
             </div>

             <!-- Metadata & Content Grid -->
             <div class="grid grid-cols-1 md:grid-cols-12 gap-12">
                 <!-- Sidebar Metadata -->
                 <div class="md:col-span-3 space-y-8 md:sticky md:top-32 h-fit border-t md:border-t-0 md:border-r border-gray-100 dark:border-gray-700 pt-8 md:pt-0 pr-4">
                     <div class="flex items-center space-x-4 md:block md:space-x-0">
                         <div class="w-14 h-14 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-full flex items-center justify-center text-gray-400 mb-0 md:mb-4 shadow-inner">
                             <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                         </div>
                         <div>
                             <p class="text-[10px] font-black uppercase text-gray-400 tracking-widest mb-1">Written By</p>
                             <p id="reader-author" class="font-bold text-dark-text dark:text-white text-base">Author Name</p>
                         </div>
                     </div>
                     
                     <div>
                         <p class="text-[10px] font-black uppercase text-gray-400 tracking-widest mb-1">Published On</p>
                         <p id="reader-date" class="font-bold text-dark-text dark:text-white font-mono text-sm text-evo-gold">Date</p>
                     </div>

                     <div class="hidden md:block opacity-50">
                         <hr class="border-gray-100 dark:border-gray-700 my-6">
                         <!-- UPDATED: Text=EVO to Text=Phoenix -->
                         <img src="https://placehold.co/100x100?text=Phoenix" class="w-12 h-12 mb-4 opacity-50 grayscale invert dark:invert-0">
                         <!-- UPDATED: Student EVO Publication to Student Rising Phoenix Publication -->
                         <p class="text-[10px] text-gray-400 font-bold uppercase leading-relaxed">Townley Grammar School<br>Student Rising Phoenix Publication</p>
                     </div>
                 </div>

                 <!-- Main Content -->
                 <div class="md:col-span-9">
                     <div id="reader-content" class="prose prose-lg dark:prose-invert prose-slate max-w-none text-gray-700 dark:text-gray-300 leading-relaxed font-serif first-letter:text-6xl first-letter:font-black first-letter:text-evo-gold first-letter:mr-3 first-letter:float-left first-letter:mt-[-10px]">
                         <!-- Content goes here -->
                     </div>
                     
                     <!-- Article Footer -->
                     <div class="mt-20 pt-12 border-t border-gray-100 dark:border-gray-700 flex justify-between items-center">
                         <button onclick="closeReader()" class="text-xs font-bold uppercase text-gray-400 hover:text-evo-red transition flex items-center gap-2">
                             <span class="bg-gray-100 dark:bg-gray-800 p-2 rounded-full">â†</span> Back to Articles
                         </button>
                         <div class="flex space-x-2">
                             <div class="w-2 h-2 bg-evo-gold rounded-full"></div>
                             <div class="w-2 h-2 bg-evo-red rounded-full"></div>
                             <div class="w-2 h-2 bg-black dark:bg-white rounded-full"></div>
                         </div>
                     </div>
                 </div>
             </div>
        </div>
    </div>

    <!-- Header & Navigation -->
    <header class="bg-white/80 dark:bg-gray-900/80 backdrop-blur-md sticky top-0 z-50 border-b border-gray-100 dark:border-gray-800 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-24">
                <!-- Updated Logo Section with Image -->
                <button onclick="resetToHome()" class="flex items-center gap-2 md:gap-4 text-lg sm:text-xl md:text-3xl font-extrabold tracking-widest uppercase text-dark-text dark:text-white group focus:outline-none hover:opacity-80 transition">
                    <img src="uploaded:image_f8fc23.png" alt="Rising Phoenix Logo" class="h-10 md:h-14 w-auto object-contain drop-shadow-sm" onerror="this.onerror=null; this.src='https://placehold.co/100x100?text=Logo'">
                    <span class="tracking-tight">
                        <span class="brand-slash text-xl md:text-4xl mr-1">//</span> Rising <span class="brand-slash text-xl md:text-4xl mx-1">//</span> Phoenix
                    </span>
                </button>
                    <div class="hidden md:flex items-center space-x-6">
                        <!-- HEADER SEARCH BAR (FUNCTIONAL) -->
                        <div class="relative hidden md:block group">
                            <input type="text" id="nav-search" placeholder="Search..." class="bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-full py-2.5 px-5 text-sm font-bold focus:ring-2 focus:ring-evo-gold focus:border-transparent focus:bg-white dark:focus:bg-gray-700 w-56 transition-all shadow-inner placeholder-gray-400 dark:text-white">
                            <svg class="w-4 h-4 absolute right-4 top-3.5 text-gray-400 group-hover:text-evo-red transition pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                        </div>

                        <!-- Linked Contribute button to Developer Access -->
                        <button onclick="handleDevClick()" class="evo-btn text-xs px-6 py-3 rounded-full shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition">Contribute</button>
                    </div>

                    <button id="mobile-menu-button" class="md:hidden text-dark-text dark:text-white focus:outline-none p-2">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    </button>
                </div>
            </div>
        </div>

        <nav class="hidden md:flex max-w-7xl mx-auto px-8 space-x-4 pointer-events-none pb-0">
            <div class="pointer-events-auto flex space-x-3">
                <button onclick="openLatestArticle()" class="nav-tab inline-block hover:text-evo-red text-gray-500">This Month's Issue</button>
                <!-- ADDED KEY DATES BUTTON HERE -->
                <button onclick="openKeyDatesModal()" class="nav-tab inline-block hover:text-evo-red text-gray-500">Key Dates</button>
                
                <!-- DROPDOWN + MODAL TRIGGER -->
                <div class="relative group">
                    <button onclick="openCategoriesModal()" class="nav-tab nav-tab-gold text-evo-gold inline-block pointer-events-auto hover:bg-black hover:text-evo-gold flex items-center gap-2 border-b-4 border-evo-gold">
                        Categories
                        <svg class="w-3 h-3 group-hover:rotate-180 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
                    </button>
                    
                    <!-- THE RESTORED DROPDOWN (Alphabetical) -->
                    <div class="category-menu pointer-events-auto">
                        <div>
                            <h4 class="text-[10px] font-black uppercase tracking-widest text-evo-red mb-4 border-b border-gray-100 dark:border-gray-700 pb-2">Categories</h4>
                            <ul class="space-y-3">
                                <li><button onclick="filterByCategory('Arts')" class="text-sm font-bold text-gray-600 dark:text-gray-300 hover:text-evo-gold hover:translate-x-1 transition-all text-left w-full">Arts</button></li>
                                <li><button onclick="filterByCategory('Current Affairs')" class="text-sm font-bold text-gray-600 dark:text-gray-300 hover:text-evo-gold hover:translate-x-1 transition-all text-left w-full">Current Affairs</button></li>
                                <li><button onclick="filterByCategory('Humanities')" class="text-sm font-bold text-gray-600 dark:text-gray-300 hover:text-evo-gold hover:translate-x-1 transition-all text-left w-full">Humanities</button></li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-[10px] font-black uppercase tracking-widest text-transparent mb-4 border-b border-gray-100 dark:border-gray-700 pb-2 select-none">.</h4>
                            <ul class="space-y-3">
                                <li><button onclick="filterByCategory('Opinion Pieces')" class="text-sm font-bold text-gray-600 dark:text-gray-300 hover:text-evo-gold hover:translate-x-1 transition-all text-left w-full">Opinion Pieces</button></li>
                                <li><button onclick="filterByCategory('Science')" class="text-sm font-bold text-gray-600 dark:text-gray-300 hover:text-evo-gold hover:translate-x-1 transition-all text-left w-full">Science</button></li>
                                <li><button onclick="filterByCategory('Tech')" class="text-sm font-bold text-gray-600 dark:text-gray-300 hover:text-evo-gold hover:translate-x-1 transition-all text-left w-full">Tech</button></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700 absolute w-full shadow-2xl p-4">
            <div class="space-y-2">
                <button onclick="openLatestArticle()" class="block w-full text-left px-4 py-3 rounded-xl text-base font-bold text-dark-text dark:text-white hover:bg-gray-50 dark:hover:bg-gray-700">This Month's Issue</button>
                <button onclick="openKeyDatesModal()" class="block w-full text-left px-4 py-3 rounded-xl text-base font-bold text-dark-text dark:text-white hover:bg-gray-50 dark:hover:bg-gray-700">Key Dates</button>
                <button onclick="openCategoriesModal()" class="block w-full text-left px-4 py-3 rounded-xl text-base font-bold text-dark-text dark:text-white hover:bg-gray-50 dark:hover:bg-gray-700">Categories</button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 min-h-screen">

        <!-- HOME VIEW CONTAINER -->
        <div id="home-view" class="transition-opacity duration-500 animate-fade-in-up">
            <!-- This Month's Issue (Dynamically Populated) -->
            <section id="this-month" class="mb-24">
                <!-- Content injected via JS -->
            </section>

            <!-- Latest Articles Grid -->
            <section id="latest" class="mb-24">
                <div class="flex flex-col md:flex-row justify-between items-end mb-12 border-b border-gray-200 dark:border-gray-700 pb-6">
                    <!-- TITLE RESTORED & CHANGED TO "Latest Stories" -->
                    <h2 class="text-3xl md:text-5xl font-black uppercase italic flex items-center mb-6 md:mb-0 tracking-tighter text-dark-text dark:text-white">
                        <span class="brand-slash text-4xl md:text-6xl mr-4">//</span> Latest Stories
                    </h2>
                    
                    <!-- SEARCH & FILTER BAR -->
                    <div class="w-full md:w-auto flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
                        <div class="relative group">
                             <!-- Search Input -->
                            <input type="text" id="search-input" placeholder="Search..." class="w-full md:w-48 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg py-3 px-4 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-evo-red placeholder-gray-400 dark:text-white shadow-sm transition">
                        </div>
                        
                        <!-- NEW YEAR FILTER (Updated with Year 12/13) -->
                        <select id="filter-year" class="filter-select w-full md:w-40 min-w-[140px] bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg py-3 px-4 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-evo-red shadow-sm cursor-pointer hover:border-gray-300 transition dark:text-white">
                             <option value="All">All Years</option>
                             <option value="Year 7">Year 7</option>
                             <option value="Year 8">Year 8</option>
                             <option value="Year 9">Year 9</option>
                             <option value="Year 10">Year 10</option>
                             <option value="Year 11">Year 11</option>
                             <option value="Year 12">Year 12</option>
                             <option value="Year 13">Year 13</option>
                             <option value="Staff">Staff</option>
                        </select>

                        <!-- MONTH FILTER (Added min-w) -->
                        <select id="filter-month" class="filter-select w-full md:w-40 min-w-[140px] bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg py-3 px-4 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-evo-red shadow-sm cursor-pointer hover:border-gray-300 transition dark:text-white">
                            <option value="All">All Months</option>
                            <option value="Jan">January</option>
                            <option value="Feb">February</option>
                            <option value="Mar">March</option>
                            <option value="Apr">April</option>
                            <option value="May">May</option>
                            <option value="Jun">June</option>
                            <option value="Jul">July</option>
                            <option value="Aug">August</option>
                            <option value="Sep">September</option>
                            <option value="Oct">October</option>
                            <option value="Nov">November</option>
                            <option value="Dec">December</option>
                        </select>

                        <!-- CATEGORY FILTER (Added min-w) -->
                        <select id="filter-category" class="filter-select w-full md:w-64 min-w-[160px] bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg py-3 px-4 text-sm font-bold focus:outline-none focus:ring-2 focus:ring-evo-red shadow-sm cursor-pointer hover:border-gray-300 transition dark:text-white">
                            <option value="All">All Categories</option>
                            <option value="Arts">Arts</option>
                            <option value="Current Affairs">Current Affairs</option>
                            <option value="Humanities">Humanities</option>
                            <option value="Opinion Pieces">Opinion Pieces</option>
                            <option value="Science">Science</option>
                            <option value="Tech">Tech</option>
                        </select>
                    </div>
                </div>
                
                <div id="articles-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                    <!-- Articles injected via JS -->
                </div>
                
                <!-- No Results Message -->
                <div id="no-results" class="hidden text-center py-20 bg-white dark:bg-gray-800 rounded-3xl border border-gray-100 dark:border-gray-700 shadow-sm">
                    <p class="text-gray-300 dark:text-gray-500 font-black uppercase tracking-widest text-xl mb-4">No Data Found</p>
                    <button onclick="resetFilters()" class="text-evo-red font-bold underline hover:text-black dark:hover:text-white transition">Clear All Filters</button>
                </div>
            </section>
        </div>

        <!-- SEARCH RESULTS VIEW (Hidden by default) -->
        <div id="search-view" class="hidden animate-fade-in-up">
            <div class="flex items-center justify-between mb-12 border-b border-gray-200 dark:border-gray-700 pb-6">
                <h2 class="text-3xl md:text-4xl font-black uppercase italic text-dark-text dark:text-white tracking-tighter">Search: <span id="search-query-display" class="text-evo-red">...</span></h2>
                <button onclick="resetToHome()" class="text-gray-400 hover:text-evo-red font-bold uppercase text-xs tracking-widest flex items-center transition group">
                    <span class="mr-2 group-hover:-translate-x-1 transition-transform">&larr;</span> Back to Home
                </button>
            </div>
            
            <div id="search-results-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                <!-- Search results injected here -->
            </div>

            <div id="search-empty" class="hidden text-center py-32">
                <p class="text-2xl font-black text-gray-200 uppercase tracking-widest mb-6">No matching articles found.</p>
                <button onclick="resetToHome()" class="evo-btn rounded-full">Return Home</button>
            </div>
        </div>

    </main>

    <footer class="bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700 transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">
                <div class="col-span-1 md:col-span-2">
                    <a href="#" class="text-3xl font-extrabold tracking-widest uppercase text-dark-text dark:text-white mb-6 block">
                        <span class="brand-slash">//</span> RISING <span class="brand-slash">//</span> PHOENIX
                    </a>
                    <p class="text-sm mt-6 text-gray-500 dark:text-gray-400 max-w-sm leading-relaxed font-medium">The Rising <span class="brand-slash text-sm">//</span> Phoenix is a year 12 run school newsletter. Elleanore P 12.11 Chief Organiser. Dan D 12.11 Chief website guy</p>
                </div>
                <div>
                    <h4 class="text-dark-text dark:text-white font-black uppercase text-xs tracking-widest mb-6 text-evo-gold">Quick Links</h4>
                    <ul class="space-y-4 text-xs font-bold uppercase tracking-wider text-gray-500 dark:text-gray-400">
                        <li><button onclick="openLatestArticle()" class="hover:text-evo-red transition text-left uppercase">This Month</button></li>
                        <li><button onclick="openKeyDatesModal()" class="hover:text-evo-red transition text-left uppercase">Key Dates</button></li>
                        <li><button onclick="openCategoriesModal()" class="hover:text-evo-red transition text-left uppercase">Categories</button></li>
                        <!-- ADDED GOOGLE FORM LINK HERE -->
                        <li><a href="https://docs.google.com/forms/d/e/1FAIpQLSf0t9qHPQ_VmPPfdX_IYvVlhWdwrV0WKz14Th3BP6JbEbRMLw/viewform?usp=sharing&ouid=109666865228153244608" target="_blank" class="hover:text-evo-red transition text-left uppercase">Feedback Form</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-dark-text dark:text-white font-black uppercase text-xs tracking-widest mb-6 text-evo-gold">Townley Grammar</h4>
                    <div class="flex space-x-6">
                        <a href="https://www.townleygrammar.org.uk/" target="_blank" class="text-gray-300 dark:text-gray-500 hover:text-evo-red transition transform hover:scale-110">
                            <!-- School / Institution Icon -->
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M2 20h20v2H2v-2zm2-8h2v7H4v-7zm5 0h2v7H9v-7zm5 0h2v7h-2v-7zm5 0h2v7h-2v-7zM12 2L2 7v2h20V7L12 2z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
            <div class="flex flex-col md:flex-row justify-between items-center pt-8 border-t border-gray-100 dark:border-gray-700">
                <div class="text-[10px] font-bold uppercase tracking-[0.2em] text-gray-300 dark:text-gray-600 mb-4 md:mb-0">
                    Townley groupe &copy; 2025
                </div>
                <!-- Developer Login Link -->
                <button onclick="handleDevClick()" class="text-[10px] font-bold uppercase text-gray-300 hover:text-evo-red transition">
                    Developer Access
                </button>
            </div>
        </div>
    </footer>

    <!-- Logic Script -->
    <script type="module">
        // Import Firebase Functions (Added deleteDoc)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBsoBwmddpu5shrgZQvK7lTTKxwh28BWcg",
          authDomain: "rising-phoenix-db.firebaseapp.com",
          projectId: "rising-phoenix-db",
          storageBucket: "rising-phoenix-db.firebasestorage.app",
          messagingSenderId: "1040016415602",
          appId: "1:1040016415602:web:a5abaa863f2ec20bda9beb"
        };

        if (typeof __firebase_config !== 'undefined') {
             try { Object.assign(firebaseConfig, JSON.parse(__firebase_config)); } catch(e) {}
        }

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'rising-phoenix-newsletter';

        // Auth State & Data Variables
        let currentUser = null;
        let dbArticles = [];

        // Auth Logic
        async function initAuth() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.warn("Authentication failed.", error);
                document.getElementById('connection-status').innerText = "ðŸ”´ Auth Failed";
            }
        }
        initAuth();

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                document.getElementById('connection-status').innerText = "ðŸŸ¢ Connected";
                document.getElementById('connection-status').className = "text-[10px] font-bold mt-1 text-green-500";
                setupRealtimeListener();
            }
        });

        function setupRealtimeListener() {
            const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'articles');
            onSnapshot(colRef, (snapshot) => {
                dbArticles = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                dbArticles.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
                loadArticles(); 
                if(!document.getElementById('dashboard-modal').classList.contains('hidden')) {
                    renderDashboardList();
                }
            }, (error) => {
                console.error("Error fetching articles.", error);
            });
        }

        // STATIC ARTICLES
        const staticArticles = [
            {
                title: "MOFs: Why This Yearâ€™s Chemistry Nobel Prize Is Like Hermioneâ€™s Handbag",
                cat: "Science",
                subject: "Chemistry",
                yearGroup: "Year 12",
                img: "https://placehold.co/600x400/222/CCAC00?text=Chemistry+Nobel",
                content: "They may not use wizarding spells, but the materials behind this yearâ€™s Nobel Prize in Chemistry can be just as astonishing as magic. In 2025, scientists Makoto Fujita, Omar Yaghi, and Susumu Kitagawa were awarded the Nobel Prize for developing Metal - Organic Frameworks, or MOFs which are materials so porous and spacious inside that theyâ€™ve been compared to Hermione Grangerâ€™s handbag. At first glance, a MOF crystal looks tiny, but under the microscope itâ€™s a labyrinth of nanoscale pores and tunnels. This gives it a huge internal surface area and just a teaspoon of MOF material can have the surface area of an entire football pitch! That means these frameworks can trap, store, and separate gases or liquids incredibly efficiently. Scientists are already using MOFs to tackle some of the biggest challenges facing our planet. They can capture carbon dioxide from the air, store clean hydrogen fuel, purify water, and even pull moisture out of desert air to make drinkable water. So while Hermioneâ€™s handbag may be a work of fiction, MOFs are proof that chemistry can create its own kind of magic, using clever design and molecular architecture to help shape a more sustainable future.",
                author: "Elleanore P 12.11",
                date: "Dec 18, 2025",
                isStatic: true,
                specialClass: "border-2 border-evo-gold/30"
            },
            {
                title: "From Weird to Wired: The Quantum Leap That Won a Nobel",
                cat: "Science",
                subject: "Physics",
                yearGroup: "Year 12",
                img: "https://placehold.co/600x400/111/EEE?text=Quantum+Physics",
                content: "Quantum physics is famously strange. In the quantum world, particles can be in two places at once, pass through barriers they should not, and absorb energy in tiny, fixed amounts. For decades, this weirdness seemed confined to atoms and subatomic particles, far removed from everyday life. But this yearâ€™s Nobel Prize in Physics went to three scientists who brought that weirdness into the real world. John Clarke, Michel Devoret, and John Martinis built tiny superconducting circuits so sensitive that they actually follow the rules of quantum mechanics. In their experiments, electrons tunnelled through barriers and energy levels â€œjumpedâ€ between discrete steps, behaviours normally seen only inside atoms. Why does that matter? Because this breakthrough helped lay the foundation for quantum computing, machines that use the strange rules of quantum physics to process information in ways no classical computer ever could. It has also opened doors to ultra-precise sensors, new materials, and technologies we can barely imagine yet. So while quantum physics might still sound weird, these Nobel winners proved it does not have to stay abstract. With the right tools (and temperatures near absolute zero), the once-mysterious quantum world can now be engineered, quite literally turning the weird into the wired.",
                author: "Elleanore P 12.11",
                date: "Dec 18, 2025",
                isStatic: true
            }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            // Check LocalStorage for Dark Mode
            if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }

            // Mobile Menu
            const button = document.getElementById('mobile-menu-button');
            const menu = document.getElementById('mobile-menu');
            if(button && menu) {
                button.addEventListener('click', () => {
                    menu.classList.toggle('hidden');
                });
            }

            loadArticles();

            document.getElementById('filter-month').addEventListener('change', loadArticles);
            document.getElementById('filter-category').addEventListener('change', loadArticles);
            document.getElementById('filter-year').addEventListener('change', loadArticles);

            const handleSearch = (e) => {
                if (e.key === 'Enter') {
                    const query = e.target.value.trim();
                    if(query) {
                        performSearch(query);
                    } else {
                        resetToHome();
                    }
                }
            };

            const mainSearch = document.getElementById('search-input');
            const navSearch = document.getElementById('nav-search');
            if(mainSearch) mainSearch.addEventListener('keydown', handleSearch);
            if(navSearch) navSearch.addEventListener('keydown', handleSearch);
        });

        // ---------------- DARK MODE LOGIC ----------------
        window.toggleDarkMode = function() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        }

        // ---------------- AUTH & NAV LOGIC ----------------
        window.handleDevClick = function() {
            if(localStorage.getItem('evo_is_admin') === 'true') {
                openDashboard();
            } else {
                openLogin();
            }
        }

        window.openLogin = function() {
            document.getElementById('login-modal').classList.remove('hidden');
        }
        
        window.closeLogin = function() {
            document.getElementById('login-modal').classList.add('hidden');
            document.getElementById('login-error').classList.add('hidden');
        }

        const loginForm = document.getElementById('login-form');
        if(loginForm) {
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const u = document.getElementById('username').value;
                const p = document.getElementById('password').value;

                if (u === 'editor' && p === 'Townley1') {
                    localStorage.setItem('evo_is_admin', 'true');
                    closeLogin();
                    openDashboard(); 
                } else {
                    document.getElementById('login-error').classList.remove('hidden');
                }
            });
        }

        // ---------------- KEY DATES MODAL LOGIC ----------------
        window.openKeyDatesModal = function() {
            document.getElementById('key-dates-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        window.closeKeyDatesModal = function() {
            document.getElementById('key-dates-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // ---------------- CATEGORIES MODAL LOGIC ----------------
        window.openCategoriesModal = function() {
            document.getElementById('categories-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        window.closeCategoriesModal = function() {
            document.getElementById('categories-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        window.filterByCategory = function(cat) {
            resetToHome();
            const select = document.getElementById('filter-category');
            select.value = cat;
            loadArticles();
            closeCategoriesModal();
            document.getElementById('latest').scrollIntoView({behavior: 'smooth'});
        }

        // ---------------- DASHBOARD LOGIC (Updated with Delete) ----------------
        window.openDashboard = function() {
            document.getElementById('dashboard-modal').classList.remove('hidden');
            renderDashboardList();
        }

        window.closeDashboard = function() {
            document.getElementById('dashboard-modal').classList.add('hidden');
        }

        window.renderDashboardList = function() {
            const listContainer = document.getElementById('dashboard-list');
            const articles = [...dbArticles, ...staticArticles];

            listContainer.innerHTML = '';
            
            articles.forEach((art) => {
                // Check if article is deletable (has an ID)
                const isDeletable = art.id ? true : false;
                const deleteBtn = isDeletable 
                    ? `<button onclick="deleteArticle('${art.id}')" class="text-gray-400 hover:text-red-600 p-2 rounded-full hover:bg-red-50 dark:hover:bg-red-900 transition" title="Delete Article">
                         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                       </button>`
                    : `<span class="text-xs text-gray-300 font-bold p-2">STATIC</span>`;

                const row = `
                <div class="flex justify-between items-center bg-gray-50 dark:bg-gray-700 p-4 rounded-xl border border-gray-100 dark:border-gray-600 hover:border-evo-gold/30 transition shadow-sm hover:shadow-md cursor-default">
                    <div class="flex items-center space-x-4">
                        <img src="${art.img}" class="w-14 h-14 rounded-lg object-cover bg-gray-200">
                        <div>
                            <h4 class="font-bold text-dark-text dark:text-white leading-tight">${art.title}</h4>
                            <div class="text-[10px] uppercase font-bold text-gray-400 flex flex-wrap gap-2 mt-1">
                                <span class="text-evo-red px-2 py-0.5 bg-red-50 dark:bg-gray-800 rounded">${art.cat}</span>
                                <span class="flex items-center text-gray-300">â€¢</span>
                                <span>${art.yearGroup || 'All'}</span>
                                <span class="flex items-center text-gray-300">â€¢</span>
                                <span>${art.author}</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center">
                        ${deleteBtn}
                    </div>
                </div>
                `;
                listContainer.insertAdjacentHTML('beforeend', row);
            });
        }

        // Function to delete article from Firestore
        window.deleteArticle = async function(docId) {
            if(!confirm("Are you sure you want to delete this article? This cannot be undone.")) return;

            try {
                // Correct path: artifacts/appId/public/data/articles/docId
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'articles', docId);
                await deleteDoc(docRef);
                // The onSnapshot listener will automatically update the UI
            } catch (error) {
                console.error("Error deleting document: ", error);
                alert("Failed to delete. Check console.");
            }
        }

        // ---------------- ARTICLE WRITER LOGIC ----------------
        window.openAddArticleForm = function() {
            document.getElementById('dashboard-modal').classList.add('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
        }

        window.backToDashboard = function() {
            document.getElementById('admin-panel').classList.add('hidden');
            openDashboard();
        }

        const articleForm = document.getElementById('article-form');
        if(articleForm) {
            articleForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (!currentUser) {
                    alert("System connecting... please wait a moment and try again.");
                    return;
                }

                const submitBtn = articleForm.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerText;
                submitBtn.innerText = "Publishing...";
                submitBtn.disabled = true;

                try {
                    const title = document.getElementById('post-title').value;
                    const catCheckboxes = document.querySelectorAll('input[name="post-cat"]:checked');
                    let catArray = Array.from(catCheckboxes).map(cb => cb.value);
                    if(catArray.length === 0) catArray = ["General"];

                    const subject = document.getElementById('post-subject').value || ""; 
                    const yearGroup = document.getElementById('post-year').value;
                    let img = document.getElementById('post-image').value;
                    const content = document.getElementById('post-content').value;
                    const author = document.getElementById('post-author').value;

                    if(!img) {
                        img = `https://placehold.co/600x400/333/EEE?text=${catArray[0]}+Update`;
                    }

                    const newArticle = {
                        title, 
                        cat: catArray, 
                        subject, 
                        yearGroup, 
                        img, 
                        content, 
                        author,
                        date: new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
                        isNew: true,
                        timestamp: Date.now() 
                    };

                    const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'articles');
                    await addDoc(colRef, newArticle);

                    articleForm.reset();
                    backToDashboard();
                } catch (err) {
                    console.error("Error publishing:", err);
                    alert("Failed to publish: " + err.message);
                } finally {
                    submitBtn.innerText = originalText;
                    submitBtn.disabled = false;
                }
            });
        }

        // ---------------- READER & DATA LOGIC ----------------
        window.closeReader = function() {
            document.getElementById('read-modal').classList.add('hidden');
            document.body.style.overflow = 'auto'; 
        }

        window.openArticle = function(cardElement) {
            const modal = document.getElementById('read-modal');
            const data = cardElement.dataset;
            
            document.getElementById('reader-image').src = data.img;
            
            const cats = data.cat.split(',');
            // Updated to use consistent slash
            const catDisplay = cats.join(' <span class="brand-slash">//</span> ');
            let fullCatString = catDisplay;
            if (data.subject && data.subject !== "") {
                fullCatString += ` <span class="brand-slash">//</span> ${data.subject}`;
            }

            document.getElementById('reader-category').innerHTML = fullCatString; // Use innerHTML to render slash span
            
            document.getElementById('reader-year').innerText = data.year;
            document.getElementById('reader-title').innerText = data.title;
            document.getElementById('reader-content').innerHTML = `<p>${data.content.replace(/\n/g, '</p><p>')}</p>`;
            document.getElementById('reader-author').innerText = data.author;
            document.getElementById('reader-date').innerText = data.date;

            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; 
        }

        function getAllArticles() {
            return [...dbArticles, ...staticArticles];
        }

        window.resetFilters = function() {
            document.getElementById('search-input').value = "";
            document.getElementById('filter-month').value = "All";
            document.getElementById('filter-category').value = "All";
            document.getElementById('filter-year').value = "All";
            loadArticles();
        }

        window.resetToHome = function() {
            closeReader();
            closeCategoriesModal();
            closeKeyDatesModal(); // Added close key dates
            closeDashboard();
            
            document.getElementById('home-view').classList.remove('hidden');
            document.getElementById('search-view').classList.add('hidden');
            document.getElementById('search-input').value = "";
            if(document.getElementById('nav-search')) document.getElementById('nav-search').value = ""; 
            loadArticles();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.openLatestArticle = function() {
            const articles = getAllArticles();
            if (articles.length > 0) {
                const latest = articles[0];
                const catString = Array.isArray(latest.cat) ? latest.cat.join(',') : latest.cat;

                const mockElement = {
                    dataset: {
                        title: latest.title,
                        cat: catString,
                        subject: latest.subject || "",
                        year: latest.yearGroup || "All",
                        img: latest.img,
                        content: latest.content,
                        author: latest.author,
                        date: latest.date
                    }
                };
                openArticle(mockElement);
            }
        }

        window.handleGlobalBack = function() {
            const reader = document.getElementById('read-modal');
            const search = document.getElementById('search-view');
            const dashboard = document.getElementById('dashboard-modal');
            const categories = document.getElementById('categories-modal');
            const keyDates = document.getElementById('key-dates-modal');
            const admin = document.getElementById('admin-panel');

            if (!reader.classList.contains('hidden')) {
                closeReader();
                return;
            }
            if (!categories.classList.contains('hidden')) {
                closeCategoriesModal();
                return;
            }
            if (!keyDates.classList.contains('hidden')) { // Added key dates back handler
                closeKeyDatesModal();
                return;
            }
            if (!admin.classList.contains('hidden')) {
                backToDashboard();
                return;
            }
            if (!dashboard.classList.contains('hidden')) {
                closeDashboard();
                return;
            }
            if (!search.classList.contains('hidden')) {
                resetToHome();
                return;
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.performSearch = function(query) {
            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('search-view').classList.remove('hidden');
            document.getElementById('search-query-display').innerText = query;

            const resultsGrid = document.getElementById('search-results-grid');
            const emptyState = document.getElementById('search-empty');
            const allArticles = getAllArticles();
            const lowerQ = query.toLowerCase();

            const matches = allArticles.filter(art => 
                art.title.toLowerCase().includes(lowerQ) || 
                art.content.toLowerCase().includes(lowerQ) ||
                art.cat.toLowerCase().includes(lowerQ) ||
                (art.subject && art.subject.toLowerCase().includes(lowerQ)) ||
                (art.author && art.author.toLowerCase().includes(lowerQ))
            );

            resultsGrid.innerHTML = '';

            if (matches.length === 0) {
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                matches.forEach(article => {
                    const html = generateCardHTML(article);
                    resultsGrid.insertAdjacentHTML('beforeend', html);
                });
            }
        }

        function generateCardHTML(article) {
            const year = article.yearGroup || "All";
            const subject = article.subject || "";
            const specialClass = article.specialClass || ""; 
            const isNewBadge = article.isNew ? '<div class="absolute top-4 left-4 bg-evo-red text-white text-[10px] font-bold px-3 py-1 uppercase tracking-tighter">New</div>' : '';
            
            const cats = Array.isArray(article.cat) ? article.cat : [article.cat];
            // Render slash with span in card
            const catString = cats.join(' <span class="brand-slash text-sm">//</span> '); 
            const catData = cats.join(',');

            return `
            <div class="evo-card rounded-xl overflow-hidden group ${specialClass}" 
                onclick="openArticle(this)"
                data-title="${article.title}"
                data-cat="${catData}"
                data-subject="${subject}"
                data-year="${year}"
                data-img="${article.img}"
                data-content="${article.content}"
                data-author="${article.author}"
                data-date="${article.date}"
            >
                <div class="relative overflow-hidden">
                    <img src="${article.img}" class="w-full h-56 object-cover transition-transform duration-500 group-hover:scale-110">
                    ${isNewBadge}
                    <div class="absolute bottom-4 right-4 bg-black/70 text-white text-[10px] font-bold px-2 py-1 rounded backdrop-blur-md uppercase">
                        ${year}
                    </div>
                </div>
                <div class="p-8">
                    <p class="text-evo-gold uppercase text-xs font-bold mb-3 tracking-widest flex items-center">${catString}</p>
                    <h3 class="block text-2xl font-black uppercase leading-tight hover:text-evo-red transition duration-200 mb-4 italic text-dark-text dark:text-white">
                        ${article.title}
                    </h3>
                    <p class="text-gray-500 dark:text-gray-400 text-xs mb-4 line-clamp-3">${article.content}</p>
                    <div class="flex justify-between items-center text-[10px] text-gray-400 font-bold border-t border-gray-100 dark:border-gray-700 pt-4">
                        <span class="flex items-center"><span class="w-2 h-2 bg-evo-red rounded-full mr-2"></span>BY ${article.author.toUpperCase()}</span>
                        <span>${article.date}</span>
                    </div>
                </div>
            </div>
            `;
        }

        window.loadArticles = function() {
            const grid = document.getElementById('articles-grid');
            const heroSection = document.getElementById('this-month');
            const noResults = document.getElementById('no-results');
            
            grid.innerHTML = '';
            
            const allArticles = getAllArticles();

            if (allArticles.length > 0) {
                const heroArt = allArticles[0];
                const heroYear = heroArt.yearGroup || "All";
                const heroSubject = heroArt.subject || "";
                
                const heroCats = Array.isArray(heroArt.cat) ? heroArt.cat : [heroArt.cat];
                // Render consistent slash in Hero
                const heroCatString = heroCats.join(' <span class="brand-slash text-sm">//</span> ');
                const heroCatData = heroCats.join(',');

                heroSection.innerHTML = `
                <div class="relative rounded-2xl overflow-hidden shadow-2xl border-4 border-white dark:border-gray-700 group cursor-pointer"
                     onclick="openArticle(this)"
                     data-title="${heroArt.title}"
                     data-cat="${heroCatData}"
                     data-subject="${heroSubject}"
                     data-year="${heroYear}"
                     data-img="${heroArt.img}"
                     data-content="${heroArt.content}"
                     data-author="${heroArt.author}"
                     data-date="${heroArt.date}">
                    
                    <img src="${heroArt.img}" alt="Featured Article" class="w-full h-[500px] object-cover transition duration-700 group-hover:scale-105">
                    
                    <div class="absolute bottom-0 left-0 w-full bg-gray-800/90 dark:bg-black/90 p-8 sm:p-12 backdrop-blur-sm border-t border-gray-700">
                        <div class="max-w-4xl">
                            <p class="text-evo-gold uppercase text-sm font-bold tracking-widest mb-3 flex items-center">
                                <span class="w-8 h-[2px] bg-evo-gold mr-3"></span> ${heroCatString} <span class="brand-slash text-sm">//</span> Featured
                            </p>
                            <h1 class="text-3xl sm:text-5xl font-black leading-tight uppercase mb-4 text-white italic drop-shadow-md">
                                ${heroArt.title}
                            </h1>
                            <p class="text-lg text-gray-300 mb-6 font-medium leading-relaxed line-clamp-2">
                                ${heroArt.content}
                            </p>
                            <button class="evo-btn rounded-none skew-x-[-10deg] inline-block hover:scale-105 transition-transform shadow-lg">
                                <span class="inline-block skew-x-[10deg]">Read This Month's Issue</span>
                            </button>
                        </div>
                    </div>
                </div>
                `;
            }

            const monthFilter = document.getElementById('filter-month').value;
            const catFilter = document.getElementById('filter-category').value;
            const yearFilter = document.getElementById('filter-year').value;

            const filtered = allArticles.filter(art => {
                const matchesMonth = monthFilter === 'All' || art.date.includes(monthFilter);
                
                const artCats = Array.isArray(art.cat) ? art.cat : [art.cat];
                const matchesCat = catFilter === 'All' || artCats.includes(catFilter);

                const matchesYear = yearFilter === 'All' || (art.yearGroup && art.yearGroup === yearFilter);

                return matchesMonth && matchesCat && matchesYear;
            });

            if(filtered.length === 0) {
                noResults.classList.remove('hidden');
            } else {
                noResults.classList.add('hidden');
                filtered.forEach(article => {
                    grid.insertAdjacentHTML('beforeend', generateCardHTML(article));
                });
            }
        }
    </script>
</body>
</html>